<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body>
    <div class="flex justify-between px-12 py-4 shadow-2xl">
      <div>
        <image
          src="/assets/vidtok.png"
          alt="logo"
          height="{256}"
          width="{256}"
          class="h-16 w-auto"
        />
      </div>
      <div class="flex justify-between items-center gap-8">
        <a href="/" class="hover:font-bold"> Home </a>
        <a href="/profile.html" class="hover:font-bold"> My Videos </a>
        <a href="/" class="hover:font-bold"> Profile </a>
      </div>
    </div>
    <div class="container p-4 mx-auto">
      <div id="video-list" class="flex flex-wrap gap-4"></div>
    </div>

    <script src="js/index.js"></script>
    <script>
      async function loadUser() {
        try {
          const res = await fetch("/.auth/me", { credentials: "include" });
          const data = await res.json();

          // Not logged in
          if (!data.length) {
            console.log("User not logged in");
            return;
          }

          const user = data[0];

          // Extract claims
          const githubId = user.user_claims.find(
            (c) => c.typ === "urn:github:id"
          )?.val;
          const name = user.user_id;
          // const name = user.user_claims.find((c) => c.typ === "name")?.val;
          const username = user.user_claims.find(
            (c) => c.typ === "preferred_username"
          )?.val;

          // Create object for storing
          const userInfo = {
            githubId,
            name,
            username,
            userId: user.user_id, // Azure user id (e.g. github|123456)
          };

          // Save to localStorage
          localStorage.setItem("userInfo", JSON.stringify(userInfo));

          console.log("Saved to localStorage:", userInfo);
        } catch (err) {
          console.error("Error:", err);
        }
      }

      loadUser();
    </script>
  </body>
</html>
